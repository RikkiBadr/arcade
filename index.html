<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Arcade ‚Ä¢ Play & Win</title>
  <meta name="description" content="Arcade with Home, Games, Leaderboard, sign up (nickname + Solana payout address). Single-file, GitHub Pages ready."/>
  <style>
    /* ===== Playful theme ===== */
    :root{
      --bg:#0a0a13;
      --panel:#111528;
      --text:#f7fbff;
      --muted:#a7b2c6;
      --accent:#ff6bd6;   /* pink */
      --accent2:#6bffce;  /* mint */
      --accent3:#ffd76b;  /* yellow */
      --line:rgba(255,255,255,.14);
      --shadow:0 10px 30px rgba(0,0,0,.45), inset 0 0 20px rgba(255,255,255,.05);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial;
      color:var(--text);
      background:
        radial-gradient(800px 500px at 12% -10%, rgba(255,107,214,.15), transparent 60%),
        radial-gradient(800px 500px at 100% 0%, rgba(107,255,206,.12), transparent 60%),
        linear-gradient(180deg,#0a0a13,#080912 60%);
      display:flex; flex-direction:column; align-items:center;
    }

    header{width:100%; max-width:1200px; padding:14px 16px; position:sticky; top:0; z-index:8;
      background:linear-gradient(180deg, rgba(8,9,18,.95), rgba(8,9,18,.65) 70%, rgba(8,9,18,0)); backdrop-filter: blur(6px)}
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .brand{display:flex; gap:12px; align-items:center}
    .logo{width:44px; aspect-ratio:1; border-radius:12px; background:
      conic-gradient(from 180deg, var(--accent), var(--accent2), var(--accent3), var(--accent));
      filter:saturate(120%); box-shadow:0 0 22px rgba(255,107,214,.35)}
    h1{font-size:22px; margin:0}
    .subtitle{font-size:12px; color:var(--muted)}

    .auth{display:flex; gap:8px; align-items:center}
    .btn{padding:10px 14px; border-radius:12px; border:1px solid var(--line); background:#131a34; color:var(--text); cursor:pointer; transition:transform .06s ease}
    .btn:hover{transform:translateY(-1px)}
    .btn-primary{background:linear-gradient(180deg,#1b2040,#121838); border-color:rgba(255,255,255,.22)}
    .chip{padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:#0f1530; color:var(--muted); font-size:12px}

    nav{width:100%; max-width:1200px; padding:6px 16px 12px; display:flex; gap:8px; flex-wrap:wrap}
    .tab{padding:10px 14px; border-radius:12px; border:1px solid var(--line); background:#121937; color:var(--text); cursor:pointer}
    .tab.active{background:linear-gradient(180deg,#1d2451,#101632); border-color:rgba(255,255,255,.25)}

    main{width:100%; max-width:1200px; padding:16px; display:grid; grid-template-columns:1fr 340px; gap:18px}
    @media (max-width:980px){ main{grid-template-columns:1fr} }

    .card{background:var(--panel); border:1px solid var(--line); border-radius:18px; box-shadow:var(--shadow)}
    .panel{padding:16px}

    /* Home */
    .banner{margin:0 0 12px; border-radius:16px; border:1px solid rgba(255,231,107,.35); background:linear-gradient(135deg, rgba(255,215,107,.18), rgba(255,107,214,.18)); color:#fff; padding:14px}
    .banner strong{color:var(--accent3)}
    .home-grid{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:840px){ .home-grid{grid-template-columns:1fr} }
    .home-tile{position:relative; border-radius:16px; overflow:hidden; border:1px solid var(--line)}
    .home-tile img{width:100%; height:220px; object-fit:cover; display:block}
    .home-tile .cap{position:absolute; left:0; right:0; bottom:0; padding:10px 12px; background:linear-gradient(180deg, transparent, rgba(0,0,0,.6)); font-weight:600}

    /* Games area */
    .controls{padding:14px; display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between}
    label{font-size:13px; color:var(--muted)}
    select,input[type="text"],input[type="number"]{appearance:none; border:none; outline:none; background:#0f1530; color:var(--text); border:1px solid rgba(255,255,255,.18); border-radius:12px; padding:10px 12px}
    .stage-wrap{padding:16px}
    .stage{width:100%; aspect-ratio:16/9; background:#060910; border-radius:16px; border:1px solid var(--line); display:grid; place-items:center; position:relative; overflow:hidden}
    canvas{width:100%; height:100%}

    /* Sidebar */
    .kpi{display:flex; align-items:center; justify-content:space-between; margin:8px 0; padding:10px 12px; background:#0f1530; border:1px solid var(--line); border-radius:12px}
    .muted{color:var(--muted)}
    .kbd{font-family:ui-monospace, Menlo, monospace; font-size:12px; padding:2px 6px; border:1px solid rgba(255,255,255,.25); border-radius:6px}
    footer{margin:20px 0 30px; color:var(--muted); font-size:12px}

    .hide{display:none}
    .leader-list{display:grid; gap:8px; margin-top:8px}
    .leader-item{display:flex; justify-content:space-between; background:#0f1530; border:1px solid var(--line); border-radius:10px; padding:8px 10px}

    /* Modal */
    .modal-backdrop{position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; place-items:center; z-index:50}
    .modal{width:min(560px,92vw); background:var(--panel); border:1px solid var(--line); border-radius:16px; box-shadow:var(--shadow); padding:16px; position:relative}
    .modal h3{margin:6px 0 12px}
    .modal .row{display:flex; gap:10px; margin:8px 0; flex-wrap:wrap}
    .modal label{display:block; font-size:12px; color:var(--muted)}
    .modal input{width:100%}
    .seg{display:flex; gap:8px; margin-bottom:10px}
    .seg .segbtn{flex:1; text-align:center}
    .close-x{position:absolute; top:12px; right:14px; cursor:pointer}
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Arcade ‚Ä¢ Play & Win</h1>
          <div class="subtitle">Home ‚Ä¢ Games ‚Ä¢ Leaderboard</div>
        </div>
      </div>
      <div class="auth">
        <span id="hello" class="chip">Guest</span>
        <button id="signinBtn" class="btn">Sign in</button>
        <button id="signupBtn" class="btn btn-primary">Sign up</button>
      </div>
    </div>
  </header>

  <nav>
    <button class="tab active" data-tab="home">Home</button>
    <button class="tab" data-tab="games">Games</button>
    <button class="tab" data-tab="leaderboard">Leaderboard</button>
  </nav>

  <main>
    <!-- LEFT content -->
    <section class="card" id="tab-home">
      <div class="panel">
        <div class="banner">üèÜ Weekly Winner Gift: Paid in <strong id="tokenSymbol">YOUR TOKEN</strong>. Make sure your <strong>payout (deposit) address</strong> in Sign Up is correct.</div>

        <!-- Replace these image src any time -->
        <div class="home-grid">
          <div class="home-tile"><img id="homeImg1" src="https://placehold.co/900x400/png?text=Banner+1" alt="Banner 1"><div class="cap">Play Snake</div></div>
          <div class="home-tile"><img id="homeImg2" src="https://placehold.co/900x400/png?text=Banner+2" alt="Banner 2"><div class="cap">Beat Flappy</div></div>
          <div class="home-tile"><img id="homeImg3" src="https://placehold.co/900x400/png?text=Banner+3" alt="Banner 3"><div class="cap">Master 2048</div></div>
          <div class="home-tile"><img id="homeImg4" src="https://placehold.co/900x400/png?text=Promo" alt="Promo"><div class="cap">Win Rewards</div></div>
        </div>
      </div>
    </section>

    <section class="card hide" id="tab-games">
      <div class="controls">
        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap">
          <label for="game">Game</label>
          <select id="game">
            <option value="snake">Snake</option>
            <option value="flappy">Flappy</option>
            <option value="2048">2048</option>
          </select>
          <button id="play" class="btn btn-primary">‚ñ∂ Play / Restart</button>
          <span class="muted">FPS:</span><span id="fps" class="kbd">‚Äî</span>
          <span class="muted">Screen:</span><span id="screen" class="kbd">‚Äî</span>
        </div>
      </div>
      <div class="stage-wrap">
        <div class="stage"><canvas id="canvas" width="960" height="540" aria-label="Game canvas" role="img"></canvas></div>
      </div>
    </section>

    <section class="card hide" id="tab-leaderboard">
      <div class="panel">
        <h3 style="margin:0 0 8px">Leaderboard</h3>
        <p class="muted" style="margin-top:0">Local demo: scores are saved in the browser. Entries include your nickname and payout address if you signed up.</p>
        <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:center">
          <label>Game</label>
          <select id="lbGame">
            <option value="snake">Snake</option>
            <option value="flappy">Flappy</option>
            <option value="2048">2048</option>
          </select>
          <button id="clearLB" class="btn">Clear Game Leaderboard</button>
        </div>
        <div class="leader-list" id="leaderList"></div>
      </div>
    </section>

    <!-- RIGHT sidebar -->
    <aside class="sidebar">
      <div class="card panel">
        <h3 style="margin:0 0 6px">Scoreboard</h3>
        <div class="kpi"><span>Score</span><strong id="score">0</strong></div>
        <div class="kpi"><span>Best (local)</span><strong id="best">0</strong></div>
        <div class="kpi"><span>State</span><strong id="state">idle</strong></div>
        <div style="margin-top:10px" class="muted">Controls: <span class="kbd">Arrows</span> / <span class="kbd">WASD</span> ‚Ä¢ <span class="kbd">Space</span> jump (Flappy) ‚Ä¢ <span class="kbd">P</span> pause
        <br>2048: <span class="kbd">Arrows</span> to slide</div>
      </div>
      <div class="card panel">
        <h3 style="margin:0 0 6px">Tips</h3>
        <p class="muted">Replace Home images by changing the <span class="kbd">src</span> of <span class="kbd">#homeImg1..4</span>. Edit banner text to change the token name.</p>
      </div>
    </aside>
  </main>

  <footer>Built with ‚ù§Ô∏è HTML5 Canvas. Single-file site. Extendable to online leaderboards and token payouts later.</footer>

  <!-- Sign In / Sign Up Modal -->
  <div class="modal-backdrop" id="authModal">
    <div class="modal">
      <div class="close-x" id="closeAuth">‚úñ</div>
      <div class="seg">
        <button class="btn segbtn btn-primary" id="segSignup">Sign up</button>
        <button class="btn segbtn" id="segSignin">Sign in</button>
      </div>
      <div id="signupForm">
        <h3>Create account</h3>
        <div class="row">
          <div style="flex:1">
            <label>Nickname</label>
            <input id="nick" placeholder="e.g. MoonBoy"/>
          </div>
          <div style="flex:1">
            <label>Payout (deposit) Solana address</label>
            <input id="payout" placeholder="Your SOL address for rewards"/>
          </div>
        </div>
        <div class="row">
          <button id="saveSignup" class="btn btn-primary">Save</button>
        </div>
      </div>
      <div id="signinForm" class="hide">
        <h3>Sign in</h3>
        <div class="row">
          <div style="flex:1">
            <label>Nickname</label>
            <input id="nickIn" placeholder="Your nickname"/>
          </div>
          <div style="flex:1">
            <label>Payout Solana address</label>
            <input id="payoutIn" placeholder="Your SOL address"/>
          </div>
        </div>
        <div class="row">
          <button id="saveSignin" class="btn btn-primary">Sign in</button>
        </div>
        <p class="muted">No server: data is stored in your browser only.</p>
      </div>
    </div>
  </div>

<script>
(() => {
  /* ===== Tabs ===== */
  const tabs = document.querySelectorAll('.tab');
  const views = {
    home: document.getElementById('tab-home'),
    games: document.getElementById('tab-games'),
    leaderboard: document.getElementById('tab-leaderboard'),
  };
  tabs.forEach(t=>t.addEventListener('click',()=>{
    tabs.forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    Object.values(views).forEach(v=>v.classList.add('hide'));
    views[t.dataset.tab].classList.remove('hide');
  }));

  /* ===== Elements ===== */
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const bestEl = document.getElementById('best');
  const stateEl = document.getElementById('state');
  const fpsEl = document.getElementById('fps');
  const screenEl = document.getElementById('screen');
  const gameSelect = document.getElementById('game');
  const playBtn = document.getElementById('play');

  /* Leaderboard */
  const lbGame = document.getElementById('lbGame');
  const leaderList = document.getElementById('leaderList');
  const clearLB = document.getElementById('clearLB');

  /* Auth modal + profile */
  const authModal = document.getElementById('authModal');
  const signinBtn = document.getElementById('signinBtn');
  const signupBtn = document.getElementById('signupBtn');
  const closeAuth = document.getElementById('closeAuth');
  const segSignup = document.getElementById('segSignup');
  const segSignin = document.getElementById('segSignin');
  const signupForm = document.getElementById('signupForm');
  const signinForm = document.getElementById('signinForm');
  const nick = document.getElementById('nick');
  const payout = document.getElementById('payout');
  const nickIn = document.getElementById('nickIn');
  const payoutIn = document.getElementById('payoutIn');
  const saveSignup = document.getElementById('saveSignup');
  const saveSignin = document.getElementById('saveSignin');
  const hello = document.getElementById('hello');
  const tokenSymbolEl = document.getElementById('tokenSymbol');

  const BEST_KEY = 'arcade_best_v3';
  const LB_KEY = 'arcade_leader_v3';
  const PROFILE_KEY = 'arcade_profile_v1';

  let game, running=false, last=0, frames=0, fps=0, paused=false;
  let best = Number(localStorage.getItem(BEST_KEY)||0);
  bestEl.textContent = best;

  /* Profile (nickname + payout address) */
  const looksLikeSol = s => /^[1-9A-HJ-NP-Za-km-z]{32,44}$/.test(s);
  const shortAddr = a => a ? a.slice(0,4)+'‚Ä¶'+a.slice(-4) : '‚Äî';
  const getProfile = () => { try { return JSON.parse(localStorage.getItem(PROFILE_KEY)||'{}'); } catch(e){ return {} } };
  const setProfile = p => { localStorage.setItem(PROFILE_KEY, JSON.stringify(p)); renderHello(p); };
  const renderHello = p => hello.textContent = p.nickname ? (p.nickname + (p.payout ? ' ‚Ä¢ '+shortAddr(p.payout) : '')) : 'Guest';
  renderHello(getProfile());

  function openModal(mode){ authModal.style.display='grid';
    if(mode==='signin'){ signupForm.classList.add('hide'); signinForm.classList.remove('hide'); segSignin.classList.add('btn-primary'); segSignup.classList.remove('btn-primary'); }
    else { signinForm.classList.add('hide'); signupForm.classList.remove('hide'); segSignup.classList.add('btn-primary'); segSignin.classList.remove('btn-primary'); }
  }
  function closeModal(){ authModal.style.display='none'; }
  signupBtn.addEventListener('click', ()=>openModal('signup'));
  signinBtn.addEventListener('click', ()=>openModal('signin'));
  closeAuth.addEventListener('click', closeModal);
  segSignup.addEventListener('click', ()=>openModal('signup'));
  segSignin.addEventListener('click', ()=>openModal('signin'));
  saveSignup.addEventListener('click', ()=>{
    const p = { nickname:(nick.value||'Player').trim(), payout:(payout.value||'').trim() };
    if(p.payout && !looksLikeSol(p.payout)) return alert('That payout address does not look like a valid Solana address.');
    setProfile(p); closeModal(); alert('Saved!');
  });
  saveSignin.addEventListener('click', ()=>{
    const p = { nickname:(nickIn.value||'Player').trim(), payout:(payoutIn.value||'').trim() };
    if(p.payout && !looksLikeSol(p.payout)) return alert('That payout address does not look like a valid Solana address.');
    setProfile(p); closeModal(); alert('Signed in!');
  });

  /* Utilities */
  function resize(){
    const rect = canvas.getBoundingClientRect();
    if(screenEl) screenEl.textContent = Math.round(rect.width)+'√ó'+Math.round(rect.height);
  }
  window.addEventListener('resize', resize); resize();
  function setState(s){stateEl.textContent=s}
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const rand=(min,max)=>Math.floor(Math.random()*(max-min+1))+min;

  /* Base game */
  class BaseGame{ constructor(){this.score=0} start(){} update(dt){} draw(){} key(k,down){} }

  /* Snake */
  class SnakeGame extends BaseGame{
    constructor(){ super(); this.gs=24; this.cols=Math.floor(canvas.width/this.gs); this.rows=Math.floor(canvas.height/this.gs); this.reset(); }
    reset(){ this.dir={x:1,y:0}; this.snake=[{x:5,y:5}]; this.food=this.spawnFood(); this.t=0; this.step=110; this.score=0; }
    spawnFood(){ let p; do{ p={x:rand(0,this.cols-1), y:rand(0,this.rows-1)} }while(this.snake.some(s=>s.x===p.x&&s.y===p.y)); return p; }
    start(){ this.reset() }
    update(dt){ this.t+=dt; while(this.t>this.step){ this.t-=this.step; this.tick(); } }
    tick(){ const head={x:this.snake[0].x+this.dir.x, y:this.snake[0].y+this.dir.y}; head.x=(head.x+this.cols)%this.cols; head.y=(head.y+this.rows)%this.rows;
      if(this.snake.some((s,i)=>i&&s.x===head.x&&s.y===head.y)){ gameOver(); return; }
      this.snake.unshift(head);
      if(head.x===this.food.x&&head.y===this.food.y){ this.score+=10; this.food=this.spawnFood(); this.step=clamp(this.step-3, 50, 120);} else this.snake.pop();
    }
    draw(){ ctx.fillStyle='#0d1020'; ctx.fillRect(0,0,canvas.width,canvas.height);
      for(let x=0;x<canvas.width;x+=this.gs){ ctx.fillStyle='rgba(255,255,255,.05)'; ctx.fillRect(x,0,1,canvas.height);}
      for(let y=0;y<canvas.height;y+=this.gs){ ctx.fillStyle='rgba(255,255,255,.05)'; ctx.fillRect(0,y,canvas.width,1);}
      ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent2'); ctx.fillRect(this.food.x*this.gs, this.food.y*this.gs, this.gs, this.gs);
      ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent'); this.snake.forEach((s,i)=>{ const a=Math.max(.3,1-i/this.snake.length); ctx.globalAlpha=a; ctx.fillRect(s.x*this.gs+1, s.y*this.gs+1, this.gs-2, this.gs-2); ctx.globalAlpha=1; });
      drawHUD(this.score);
    }
    key(k,down){ if(!down) return; const d=this.dir;
      if(k==='ArrowUp'||k==='KeyW'){ if(d.y!==1) this.dir={x:0,y:-1} }
      if(k==='ArrowDown'||k==='KeyS'){ if(d.y!==-1) this.dir={x:0,y:1} }
      if(k==='ArrowLeft'||k==='KeyA'){ if(d.x!==1) this.dir={x:-1,y:0} }
      if(k==='ArrowRight'||k==='KeyD'){ if(d.x!==-1) this.dir={x:1,y:0} }
    }
  }

  /* Flappy */
  class FlappyGame extends BaseGame{
    constructor(){ super(); this.reset(); }
    reset(){ this.bird={x:160,y:canvas.height/2,vy:0}; this.gravity=900; this.impulse=-320; this.pipes=[]; this.spawnTimer=0; this.spawnEvery=1500; this.speed=150; this.gap=170; this.alive=true; this.score=0; }
    start(){ this.reset() }
    update(dt){ if(!this.alive) return;
      this.bird.vy += this.gravity*(dt/1000); this.bird.y += this.bird.vy*(dt/1000);
      this.spawnTimer+=dt; while(this.spawnTimer>this.spawnEvery){ this.spawnTimer-=this.spawnEvery; const h=rand(80, canvas.height-80-this.gap); this.pipes.push({x:canvas.width+40, top:h, bottom:h+this.gap, w:70, scored:false}); }
      this.pipes.forEach(p=>p.x -= this.speed*(dt/1000)); this.pipes = this.pipes.filter(p=>p.x+p.w>-10);
      if(this.bird.y<0 || this.bird.y>canvas.height){ this.alive=false; gameOver(); }
      for(const p of this.pipes){
        if(this.bird.x>p.x+p.w && !p.scored){ p.scored=true; this.score+=1; }
        if(this.bird.x>p.x-12 && this.bird.x<p.x+p.w+12){ if(this.bird.y<p.top || this.bird.y>p.bottom){ this.alive=false; gameOver(); } }
      }
    }
    draw(){ const g=ctx.createLinearGradient(0,0,0,canvas.height); g.addColorStop(0,'#151a3a'); g.addColorStop(1,'#0b0f1f'); ctx.fillStyle=g; ctx.fillRect(0,0,canvas.width,canvas.height);
      this.pipes.forEach(p=>{ ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent'); ctx.fillRect(p.x,0,p.w,p.top); ctx.fillRect(p.x,p.bottom,p.w,canvas.height-p.bottom); });
      ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent2'); ctx.beginPath(); ctx.arc(this.bird.x,this.bird.y,12,0,Math.PI*2); ctx.fill();
      ctx.fillStyle='rgba(255,255,255,.15)'; ctx.fillRect(0,canvas.height-4,canvas.width,4);
      drawHUD(this.score);
    }
    key(k,down){ if(!down) return; if(k==='Space'||k==='ArrowUp'||k==='KeyW') this.bird.vy=this.impulse; }
  }

  /* 2048 */
  class Game2048 extends BaseGame{
    constructor(){ super(); this.size=4; this.grid=[...Array(this.size)].map(()=>Array(this.size).fill(0)); this.reset(); }
    reset(){ this.grid.forEach(r=>r.fill(0)); this.addTile(); this.addTile(); this.score=0; }
    start(){ this.reset() }
    addTile(){ const empty=[]; for(let y=0;y<this.size;y++){ for(let x=0;x<this.size;x++){ if(!this.grid[y][x]) empty.push({x,y}); } } if(!empty.length) return; const {x,y}=empty[rand(0,empty.length-1)]; this.grid[y][x]=Math.random()<0.9?2:4; }
    slide(row){ const arr=row.filter(v=>v); for(let i=0;i<arr.length-1;i++){ if(arr[i]===arr[i+1]){ arr[i]*=2; this.score+=arr[i]; arr.splice(i+1,1);} } while(arr.length<4) arr.push(0); return arr; }
    move(dir){ let moved=false;
      if(dir===0){ for(let y=0;y<4;y++){ const n=this.slide(this.grid[y]); if(n.some((v,i)=>v!==this.grid[y][i])) moved=true; this.grid[y]=n; } }
      if(dir===1){ for(let y=0;y<4;y++){ let r=[...this.grid[y]].reverse(); r=this.slide(r).reverse(); if(r.some((v,i)=>v!==this.grid[y][i])) moved=true; this.grid[y]=r; } }
      if(dir===2){ for(let x=0;x<4;x++){ let col=[0,1,2,3].map(y=>this.grid[y][x]); col=this.slide(col); if(col.some((v,i)=>v!==this.grid[i][x])) moved=true; for(let y=0;y<4;y++) this.grid[y][x]=col[y]; } }
      if(dir===3){ for(let x=0;x<4;x++){ let col=[0,1,2,3].map(y=>this.grid[y][x]).reverse(); col=this.slide(col).reverse(); if(col.some((v,i)=>v!==this.grid[i][x])) moved=true; for(let y=0;y<4;y++) this.grid[y][x]=col[y]; } }
      if(moved) this.addTile();
      if(this.isGameOver()) gameOver();
    }
    isGameOver(){ for(let y=0;y<4;y++){ for(let x=0;x<4;x++){ if(this.grid[y][x]===0) return false; if(x<3 && this.grid[y][x]===this.grid[y][x+1]) return false; if(y<3 && this.grid[y][x]===this.grid[y+1][x]) return false; } } return true; }
    update(dt){}
    draw(){ ctx.fillStyle='#10142b'; ctx.fillRect(0,0,canvas.width,canvas.height);
      const s=100; const offX=(canvas.width-4*s)/2; const offY=(canvas.height-4*s)/2;
      for(let y=0;y<4;y++){ for(let x=0;x<4;x++){ const v=this.grid[y][x];
        ctx.fillStyle='rgba(255,255,255,.09)'; ctx.fillRect(offX+x*s+6, offY+y*s+6, s-12, s-12);
        if(v){ ctx.fillStyle= v<8? '#6bffce' : v<32? '#ff6bd6' : v<128? '#ffd76b' : '#f7fbff';
          ctx.fillRect(offX+x*s+6, offY+y*s+6, s-12, s-12);
          ctx.fillStyle='#061018'; ctx.font='24px ui-monospace, Menlo, monospace'; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(String(v), offX+x*s+s/2, offY+y*s+s/2);
        }
      } }
      drawHUD(this.score);
    }
    key(k,down){ if(!down) return; if(k==='ArrowLeft') this.move(0); if(k==='ArrowRight') this.move(1); if(k==='ArrowUp') this.move(2); if(k==='ArrowDown') this.move(3); }
  }

  function drawHUD(score){ ctx.font='20px ui-monospace, Menlo, monospace'; ctx.fillStyle='rgba(234,246,255,.85)'; ctx.fillText(`Score: ${score}`, 16, 28); ctx.fillText(`Best: ${best}`, 16, 52); }

  function gameOver(){
    running=false; setState('game over');
    if(game.score>best){ best=game.score; localStorage.setItem(BEST_KEY, String(best)); bestEl.textContent=best; }
    saveLeaderboardEntry();
    ctx.fillStyle='rgba(0,0,0,.55)'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='#eaf6ff'; ctx.font='28px ui-monospace, Menlo, monospace';
    ctx.fillText('Game Over ‚Äì Press Play to restart', 220, canvas.height/2);
  }

  function startGame(){
    const type = gameSelect.value;
    if(type==='snake') game = new SnakeGame();
    else if(type==='flappy') game = new FlappyGame();
    else game = new Game2048();
    game.start();
    running=true; paused=false; setState('playing'); scoreEl.textContent='0';
    last=0; requestAnimationFrame(loop);
  }

  function loop(ts){ if(!running) return; if(!last) last=ts; const dt=ts-last; last=ts; frames++; if(frames%12===0){ fps=Math.round(1000/dt); if(fpsEl) fpsEl.textContent=fps; } if(!paused){ game.update(dt); game.draw(); scoreEl.textContent=game.score; } requestAnimationFrame(loop); }

  /* Input */
  window.addEventListener('keydown', e=>{ if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight','Space'].includes(e.code)) e.preventDefault(); if(e.code==='KeyP'){ paused=!paused; setState(paused? 'paused':'playing'); return;} if(game) game.key(e.code, true); });
  window.addEventListener('keyup', e=>{ if(game) game.key(e.code, false); });
  document.getElementById('play').addEventListener('click', startGame);

  /* Leaderboard (local) */
  function getLB(){ try{ return JSON.parse(localStorage.getItem(LB_KEY)||'{}'); }catch(e){ return {} } }
  function setLB(obj){ localStorage.setItem(LB_KEY, JSON.stringify(obj)); }
  function saveLeaderboardEntry(){
    const g = gameSelect.value;
    const prof = getProfile();
    const entry = { ts: Date.now(), nick: prof.nickname||'guest', addr: prof.payout||'‚Äî', score: game.score };
    const lb = getLB(); lb[g]=lb[g]||[]; lb[g].push(entry); lb[g].sort((a,b)=>b.score-a.score); lb[g]=lb[g].slice(0,20); setLB(lb);
  }
  function renderLB(){
    const g = lbGame.value; const lb = getLB(); const list = lb[g]||[]; leaderList.innerHTML='';
    list.forEach((e,i)=>{ const div=document.createElement('div'); div.className='leader-item';
      const t=new Date(e.ts).toLocaleString();
      const short = e.addr && e.addr!=='‚Äî' ? (e.addr.slice(0,4)+'‚Ä¶'+e.addr.slice(-4)) : '‚Äî';
      div.innerHTML=`<span>#${i+1}</span><strong>${e.nick}</strong><span class="kbd">${short}</span><strong>${e.score}</strong><span class="muted">${t}</span>`;
      leaderList.appendChild(div);
    });
  }
  lbGame.addEventListener('change', renderLB);
  document.getElementById('clearLB').addEventListener('click',()=>{ const g=lbGame.value; const lb=getLB(); delete lb[g]; setLB(lb); renderLB(); });
  renderLB();

})();
</script>
</body>
</html>
