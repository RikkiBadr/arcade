<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Creator Arcade â€¢ Play â€¢ Compete â€¢ Earn</title>
<meta name="description" content="Neon arcade with sign-in, game cards, canvas games, and local leaderboard."/>
<style>
  /* ---------- THEME (CreatorGames-like) ---------- */
  :root{
    --bg:#0b0f14;
    --panel:#0f1421;
    --panel-2:#11182a;
    --text:#eef5ff;
    --muted:#9aa8bc;
    --accent:#ff57de;   /* magenta */
    --accent2:#57ffd3;  /* mint */
    --accent3:#ffd45a;  /* yellow */
    --line:rgba(255,255,255,.10);
    --glow:0 0 28px rgba(255,87,222,.35);
    --card-glow:0 24px 60px rgba(0,0,0,.45), 0 0 40px rgba(255,87,222,.08);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    color:var(--text);
    background:
      radial-gradient(1200px 800px at -10% -20%, rgba(255,87,222,.10), transparent 60%),
      radial-gradient(1200px 800px at 120% -30%, rgba(87,255,211,.08), transparent 60%),
      #0b0f14;
  }

  /* ---------- HEADER ---------- */
  header{
    position:sticky; top:0; z-index:20;
    backdrop-filter:saturate(120%) blur(8px);
    background:linear-gradient(180deg, rgba(11,15,20,.92), rgba(11,15,20,.55) 60%, rgba(11,15,20,0));
    border-bottom:1px solid var(--line);
  }
  .top{
    max-width:1200px; margin:auto; padding:12px 16px;
    display:flex; align-items:center; justify-content:space-between; gap:16px;
  }
  .brand{display:flex; align-items:center; gap:12px}
  .logo{
    width:34px; aspect-ratio:1; border-radius:10px;
    background:conic-gradient(from 180deg, var(--accent), var(--accent2), var(--accent3), var(--accent));
    box-shadow:var(--glow);
  }
  .brand h1{font-size:18px; letter-spacing:.04em; margin:0}
  .nav{display:flex; align-items:center; gap:12px}
  .chip{font-size:12px; color:var(--muted); padding:6px 10px; border:1px solid var(--line); border-radius:999px; background:#0f1628}
  .btn{padding:10px 14px; border-radius:12px; border:1px solid var(--line); background:#121a31; color:#fff; cursor:pointer}
  .btn-primary{background:linear-gradient(180deg, #232a5a, #121a31); border-color:rgba(255,255,255,.18)}
  .btn:hover{transform:translateY(-1px)}
  a,button{font:inherit}

  /* ---------- HERO ---------- */
  .hero{max-width:1200px; margin:18px auto 8px; padding:0 16px; text-align:center}
  .bar{
    height:54px; border-radius:14px; border:1px solid rgba(255,87,222,.35);
    background:linear-gradient(90deg, #ff57de, #7c67ff, #57ffd3);
    box-shadow:0 0 30px rgba(255,87,222,.25);
    margin:10px auto 6px; max-width:740px;
  }
  .hero h2{margin:6px 0 0; font-weight:600}
  .hero p{max-width:880px; margin:10px auto; color:var(--muted); line-height:1.6}
  .hero p a{color:#dba8ff; text-decoration:none}
  .notice{
    max-width:1200px; margin:18px auto 0; padding:12px 16px;
    border:1px solid var(--line); border-radius:12px; background:#121a31;
    color:#cfe3ff; text-align:center;
  }

  /* ---------- MAIN ---------- */
  .wrap{max-width:1200px; margin:18px auto 40px; padding:0 16px}
  .section-title{font-size:22px; margin:14px 0}
  .games-grid{
    display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:18px;
  }
  @media (max-width:1000px){ .games-grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
  @media (max-width:680px){ .games-grid{grid-template-columns:1fr;} }

  .card{
    background:linear-gradient(180deg, var(--panel-2), #0f1421);
    border:1px solid var(--line);
    border-radius:18px; overflow:hidden; box-shadow:var(--card-glow);
    display:flex; flex-direction:column;
  }
  .thumb{position:relative; aspect-ratio:16/9; overflow:hidden; border-bottom:1px solid var(--line)}
  .thumb img{width:100%; height:100%; object-fit:cover}
  .title-overlay{
    position:absolute; left:14px; bottom:12px; padding:6px 10px 7px;
    border-radius:10px; font-weight:700; letter-spacing:.02em;
    background:rgba(11,15,20,.55); border:1px solid rgba(255,255,255,.2);
    text-shadow:0 0 14px rgba(255,87,222,.6);
  }
  .body{padding:12px 14px; color:var(--muted)}
  .stats{
    display:grid; grid-template-columns:1fr 1fr; gap:10px; padding:12px 14px;
    border-top:1px solid var(--line); background:#0f1628;
  }
  .stat{
    display:flex; align-items:center; justify-content:space-between; gap:8px;
    padding:8px 10px; border:1px solid var(--line); border-radius:10px; color:#cfe3ff;
    background:linear-gradient(180deg,#0f1628,#0b1222);
  }
  .actions{display:flex; padding:12px 14px; gap:10px; border-top:1px solid var(--line)}
  .actions .btn{flex:1}

  /* ---------- GAME/LEADERBOARD AREA (hidden until used) ---------- */
  .panel{background:#0f1421; border:1px solid var(--line); border-radius:18px; padding:14px; margin-top:26px}
  .controls{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  label{font-size:13px; color:var(--muted)}
  select{appearance:none; border:none; outline:none; background:#0f1628; color:#fff; border:1px solid var(--line); border-radius:10px; padding:10px 12px}
  .stage{margin-top:12px; border:1px solid var(--line); border-radius:14px; overflow:hidden; background:#060a13; aspect-ratio:16/9; display:grid; place-items:center}
  canvas{width:100%; height:100%}
  .two-col{display:grid; grid-template-columns:1fr 320px; gap:16px}
  @media (max-width:1020px){ .two-col{grid-template-columns:1fr} }
  .kpi{display:flex; align-items:center; justify-content:space-between; background:#0f1628; border:1px solid var(--line); border-radius:10px; padding:10px 12px; margin:8px 0}
  .kbd{font-family:ui-monospace,Menlo,monospace; font-size:12px; padding:2px 6px; border:1px solid rgba(255,255,255,.22); border-radius:6px; color:#bed8ff}
  .leader-list{display:grid; gap:8px}
  .leader-item{display:flex; justify-content:space-between; padding:8px 10px; background:#0f1628; border:1px solid var(--line); border-radius:10px}

  /* ---------- MODAL (Sign in/Sign up) ---------- */
  .modal-backdrop{position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; place-items:center; z-index:50}
  .modal{width:min(560px,92vw); background:#0f1421; border:1px solid var(--line); border-radius:16px; padding:16px}
  .modal h3{margin:6px 0 10px}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .row > div{flex:1}
  .modal input{width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--line); background:#0f1628; color:#fff}
  .seg{display:flex; gap:8px; margin-bottom:10px}
  .seg .btn{flex:1; text-align:center}
</style>
</head>
<body>

<header>
  <div class="top">
    <div class="brand">
      <div class="logo"></div>
      <h1>CREATOR ARCADE</h1>
    </div>
    <div class="nav">
      <a class="chip" id="hello">Guest</a>
      <a class="chip" id="toLeaderboardsBtn">Leaderboards</a>
      <button class="btn" id="signinBtn">Sign in</button>
      <button class="btn btn-primary" id="signupBtn">Sign up</button>
    </div>
  </div>
</header>

<section class="hero">
  <div class="bar" aria-hidden="true"></div>
  <h2>Play â€¢ Compete â€¢ Earn</h2>
  <p>
    Welcome to the ultimate blockchain gaming experience!
    Play classic games, climb the <strong>leaderboards</strong>, and earn real rewards.
    Top player from each game's leaderboard receives rewards from the creator rewards split. Compete now and earn while you play!
  </p>
</section>

<div class="notice">ðŸŽ® <strong>Sign in</strong> to save your scores and compete on leaderboards!</div>

<div class="wrap">
  <h3 class="section-title">Games</h3>

  <!-- ---------- GAME CARDS ---------- -->
  <div class="games-grid">
    <!-- Flappy -->
    <article class="card">
      <div class="thumb">
        <img src="https://images.unsplash.com/photo-1520975930426-c62f0a25d87a?q=80&w=1600&auto=format&fit=crop" alt="Flappy Bird">
        <div class="title-overlay">Flappy Bird</div>
      </div>
      <div class="body">Navigate through pipes in this endless flying game.</div>
      <div class="stats">
        <div class="stat"><span>High Score</span><strong id="sflappy">â€”</strong></div>
        <div class="stat"><span>Times Played</span><strong id="pflappy">â€”</strong></div>
      </div>
      <div class="actions">
        <button class="btn btn-primary" data-play="flappy">Play</button>
        <button class="btn" data-leader="flappy">Leaderboard</button>
      </div>
    </article>

    <!-- Snake -->
    <article class="card">
      <div class="thumb">
        <img src="https://images.unsplash.com/photo-1565728744382-61accd4aa148?q=80&w=1600&auto=format&fit=crop" alt="Snake">
        <div class="title-overlay">Snake</div>
      </div>
      <div class="body">Guide the snake to collect food and grow longer.</div>
      <div class="stats">
        <div class="stat"><span>High Score</span><strong id="ssnake">â€”</strong></div>
        <div class="stat"><span>Times Played</span><strong id="psnake">â€”</strong></div>
      </div>
      <div class="actions">
        <button class="btn btn-primary" data-play="snake">Play</button>
        <button class="btn" data-leader="snake">Leaderboard</button>
      </div>
    </article>

    <!-- 2048 -->
    <article class="card">
      <div class="thumb">
        <img src="https://images.unsplash.com/photo-1518779578993-ec3579fee39f?q=80&w=1600&auto=format&fit=crop" alt="2048">
        <div class="title-overlay">2048</div>
      </div>
      <div class="body">Slide the tiles to reach 2048. Simple, addictive, brutal.</div>
      <div class="stats">
        <div class="stat"><span>High Score</span><strong id="s2048">â€”</strong></div>
        <div class="stat"><span>Times Played</span><strong id="p2048">â€”</strong></div>
      </div>
      <div class="actions">
        <button class="btn btn-primary" data-play="2048">Play</button>
        <button class="btn" data-leader="2048">Leaderboard</button>
      </div>
    </article>
  </div>

  <!-- ---------- GAME AREA + SIDEBAR (hidden until play) ---------- -->
  <section class="panel two-col" id="gameArea" style="display:none">
    <div>
      <div class="controls">
        <label for="game">Game</label>
        <select id="game">
          <option value="flappy">Flappy</option>
          <option value="snake">Snake</option>
          <option value="2048">2048</option>
        </select>
        <button class="btn btn-primary" id="playBtn">â–¶ Play / Restart</button>
        <span class="chip">FPS <span id="fps">â€”</span></span>
        <span class="chip">Screen <span id="screen">â€”</span></span>
      </div>
      <div class="stage"><canvas id="canvas" width="960" height="540"></canvas></div>
    </div>

    <aside>
      <div class="kpi"><span>Score</span><strong id="score">0</strong></div>
      <div class="kpi"><span>Best (local)</span><strong id="best">0</strong></div>
      <div class="kpi"><span>State</span><strong id="state">idle</strong></div>
      <div class="panel">
        Controls:
        <span class="kbd">Arrows</span> / <span class="kbd">WASD</span> â€”
        <span class="kbd">Space</span> (Flappy) â€”
        <span class="kbd">P</span> pause
      </div>
    </aside>
  </section>

  <!-- ---------- LEADERBOARD PANEL ---------- -->
  <section class="panel" id="lbArea" style="display:none">
    <div class="controls" style="margin-bottom:10px">
      <label>Game</label>
      <select id="lbGame">
        <option value="flappy">Flappy</option>
        <option value="snake">Snake</option>
        <option value="2048">2048</option>
      </select>
      <button class="btn" id="clearLB">Clear Game Leaderboard</button>
    </div>
    <div class="leader-list" id="leaderList"></div>
  </section>
</div>

<!-- ---------- SIGN IN / SIGN UP MODAL ---------- -->
<div class="modal-backdrop" id="authModal">
  <div class="modal">
    <div class="seg">
      <button class="btn" id="segSignin">Sign in</button>
      <button class="btn btn-primary" id="segSignup">Sign up</button>
    </div>

    <div id="signinForm">
      <h3>Sign in</h3>
      <div class="row">
        <div><label>Nickname</label><input id="nickIn" placeholder="Your nickname"/></div>
        <div><label>Payout Solana address</label><input id="payoutIn" placeholder="Your SOL address"/></div>
      </div>
      <div style="margin-top:10px"><button class="btn btn-primary" id="saveSignin">Sign in</button></div>
    </div>

    <div id="signupForm" style="display:none">
      <h3>Create account</h3>
      <div class="row">
        <div><label>Nickname</label><input id="nick" placeholder="e.g. MoonBoy"/></div>
        <div><label>Payout (deposit) Solana address</label><input id="payout" placeholder="SOL address for rewards"/></div>
      </div>
      <div style="margin-top:10px"><button class="btn btn-primary" id="saveSignup">Save</button></div>
    </div>
  </div>
</div>

<script>
(() => {
  /* ---------- Helpers & State ---------- */
  const $ = s => document.querySelector(s);
  const $$ = s => document.querySelectorAll(s);
  const looksLikeSol = s => /^[1-9A-HJ-NP-Za-km-z]{32,44}$/.test(s);
  const short = a => a ? a.slice(0,4)+'â€¦'+a.slice(-4) : 'â€”';

  // Storage keys
  const BEST_KEY = 'arcade_best_v4';
  const LB_KEY = 'arcade_lb_v4';
  const PROFILE_KEY = 'arcade_profile_v2';
  let best = Number(localStorage.getItem(BEST_KEY)||0);

  // Profile
  const getProfile = () => { try { return JSON.parse(localStorage.getItem(PROFILE_KEY)||'{}'); } catch { return {} } };
  const setProfile = p => { localStorage.setItem(PROFILE_KEY, JSON.stringify(p)); renderHello(); };
  const renderHello = () => {
    const p = getProfile();
    $('#hello').textContent = p.nickname ? (p.nickname + (p.payout ? ' â€¢ '+short(p.payout):'')) : 'Guest';
  };
  renderHello();

  /* ---------- Modal ---------- */
  const showModal = (mode='signin') => {
    $('#authModal').style.display='grid';
    $('#signinForm').style.display = mode==='signin'?'block':'none';
    $('#signupForm').style.display = mode==='signup'?'block':'none';
  };
  const hideModal = () => $('#authModal').style.display='none';

  $('#signinBtn').onclick = () => showModal('signin');
  $('#signupBtn').onclick = () => showModal('signup');
  $('#segSignin').onclick = () => showModal('signin');
  $('#segSignup').onclick = () => showModal('signup');
  // click outside to close
  $('#authModal').addEventListener('click', e => { if(e.target.id==='authModal') hideModal(); });

  $('#saveSignup').onclick = () => {
    const p = { nickname: ($('#nick').value||'Player').trim(), payout: ($('#payout').value||'').trim() };
    if(p.payout && !looksLikeSol(p.payout)) return alert('That Solana address does not look valid.');
    setProfile(p); hideModal(); alert('Saved!');
  };
  $('#saveSignin').onclick = () => {
    const p = { nickname: ($('#nickIn').value||'Player').trim(), payout: ($('#payoutIn').value||'').trim() };
    if(p.payout && !looksLikeSol(p.payout)) return alert('That Solana address does not look valid.');
    setProfile(p); hideModal(); alert('Signed in!');
  };

  /* ---------- Cards â†’ open game / leaderboard ---------- */
  $$('.actions [data-play]').forEach(b=>{
    b.onclick = () => {
      const g = b.dataset.play;
      $('#game').value = g;
      startSection('game');
      startGame();
      incrementPlays(g);
    }
  });
  $$('.actions [data-leader]').forEach(b=>{
    b.onclick = () => { $('#lbGame').value = b.dataset.leader; startSection('leader'); renderLB(); };
  });
  $('#toLeaderboardsBtn').onclick = () => { startSection('leader'); renderLB(); };

  function startSection(which){
    if(which==='game'){ $('#gameArea').style.display='grid'; $('#lbArea').style.display='none'; window.scrollTo({top:document.body.scrollHeight, behavior:'smooth'}); }
    else { $('#gameArea').style.display='none'; $('#lbArea').style.display='block'; window.scrollTo({top:document.body.scrollHeight, behavior:'smooth'}); }
  }

  /* ---------- Game engine (same as before, trimmed) ---------- */
  const canvas = $('#canvas'), ctx = canvas.getContext('2d');
  const scoreEl=$('#score'), bestEl=$('#best'), stateEl=$('#state'), fpsEl=$('#fps'), screenEl=$('#screen');
  bestEl.textContent = best;

  function resize(){ const r=canvas.getBoundingClientRect(); screenEl.textContent=Math.round(r.width)+'Ã—'+Math.round(r.height); }
  window.addEventListener('resize', resize); resize();

  let game, running=false, last=0, frames=0, fps=0, paused=false;

  class BaseGame{ constructor(){this.score=0} start(){} update(dt){} draw(){} key(k,down){} }
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;

  class Flappy extends BaseGame{
    constructor(){ super(); this.reset(); }
    reset(){ this.bird={x:160,y:canvas.height/2,vy:0}; this.g=900; this.impulse=-320; this.pipes=[]; this.t=0; this.every=1500; this.speed=150; this.gap=170; this.alive=true; this.score=0; }
    start(){ this.reset(); }
    update(dt){ if(!this.alive) return; this.bird.vy+=this.g*(dt/1000); this.bird.y+=this.bird.vy*(dt/1000);
      this.t+=dt; while(this.t>this.every){ this.t-=this.every; const h=rand(80, canvas.height-80-this.gap); this.pipes.push({x:canvas.width+40, top:h, bottom:h+this.gap, w:70, scored:false}); }
      this.pipes.forEach(p=>p.x-=this.speed*(dt/1000)); this.pipes=this.pipes.filter(p=>p.x+p.w>-10);
      if(this.bird.y<0||this.bird.y>canvas.height){ this.alive=false; gameOver(); }
      for(const p of this.pipes){ if(this.bird.x>p.x+p.w && !p.scored){ p.scored=true; this.score++; }
        if(this.bird.x>p.x-12 && this.bird.x<p.x+p.w+12){ if(this.bird.y<p.top||this.bird.y>p.bottom){ this.alive=false; gameOver(); } } }
    }
    draw(){ const g=ctx.createLinearGradient(0,0,0,canvas.height); g.addColorStop(0,'#152241'); g.addColorStop(1,'#0a111f'); ctx.fillStyle=g; ctx.fillRect(0,0,canvas.width,canvas.height);
      this.pipes.forEach(p=>{ ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent'); ctx.fillRect(p.x,0,p.w,p.top); ctx.fillRect(p.x,p.bottom,p.w,canvas.height-p.bottom); });
      ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent2'); ctx.beginPath(); ctx.arc(this.bird.x,this.bird.y,12,0,Math.PI*2); ctx.fill();
      drawHUD(this.score);
    }
    key(k,d){ if(!d) return; if(k==='Space'||k==='ArrowUp'||k==='KeyW') this.bird.vy=this.impulse; }
  }

  class Snake extends BaseGame{
    constructor(){ super(); this.gs=24; this.cols=Math.floor(canvas.width/this.gs); this.rows=Math.floor(canvas.height/this.gs); this.reset(); }
    reset(){ this.dir={x:1,y:0}; this.snake=[{x:5,y:5}]; this.food=this.spawn(); this.t=0; this.step=110; this.score=0; }
    spawn(){ let p; do{ p={x:rand(0,this.cols-1),y:rand(0,this.rows-1)} }while(this.snake.some(s=>s.x===p.x&&s.y===p.y)); return p; }
    start(){ this.reset(); }
    update(dt){ this.t+=dt; while(this.t>this.step){ this.t-=this.step; this.tick(); } }
    tick(){ const h={x:this.snake[0].x+this.dir.x,y:this.snake[0].y+this.dir.y}; h.x=(h.x+this.cols)%this.cols; h.y=(h.y+this.rows)%this.rows;
      if(this.snake.some((s,i)=>i&&s.x===h.x&&s.y===h.y)){ gameOver(); return; }
      this.snake.unshift(h);
      if(h.x===this.food.x&&h.y===this.food.y){ this.score+=10; this.food=this.spawn(); this.step=Math.max(50,this.step-3);} else this.snake.pop();
    }
    draw(){ ctx.fillStyle='#0d1326'; ctx.fillRect(0,0,canvas.width,canvas.height);
      for(let x=0;x<canvas.width;x+=this.gs){ ctx.fillStyle='rgba(255,255,255,.05)'; ctx.fillRect(x,0,1,canvas.height) }
      for(let y=0;y<canvas.height;y+=this.gs){ ctx.fillStyle='rgba(255,255,255,.05)'; ctx.fillRect(0,y,canvas.width,1) }
      ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent2'); ctx.fillRect(this.food.x*this.gs,this.food.y*this.gs,this.gs,this.gs);
      ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent'); this.snake.forEach((s,i)=>{ const a=Math.max(.3,1-i/this.snake.length); ctx.globalAlpha=a; ctx.fillRect(s.x*this.gs+1,s.y*this.gs+1,this.gs-2,this.gs-2); ctx.globalAlpha=1; });
      drawHUD(this.score);
    }
    key(k,d){ if(!d) return; const t=this.dir; if(k==='ArrowUp'||k==='KeyW'){ if(t.y!==1) this.dir={x:0,y:-1} } if(k==='ArrowDown'||k==='KeyS'){ if(t.y!==-1) this.dir={x:0,y:1} } if(k==='ArrowLeft'||k==='KeyA'){ if(t.x!==1) this.dir={x:-1,y:0} } if(k==='ArrowRight'||k==='KeyD'){ if(t.x!==-1) this.dir={x:1,y:0} } }
  }

  class G2048 extends BaseGame{
    constructor(){ super(); this.size=4; this.grid=[...Array(4)].map(()=>Array(4).fill(0)); this.reset(); }
    reset(){ this.grid.forEach(r=>r.fill(0)); this.add(); this.add(); this.score=0; }
    start(){ this.reset(); }
    add(){ const e=[]; for(let y=0;y<4;y++) for(let x=0;x<4;x++) if(!this.grid[y][x]) e.push({x,y}); if(!e.length) return; const p=e[Math.floor(Math.random()*e.length)]; this.grid[p.y][p.x]=Math.random()<0.9?2:4; }
    slide(r){ const a=r.filter(v=>v); for(let i=0;i<a.length-1;i++){ if(a[i]===a[i+1]){ a[i]*=2; this.score+=a[i]; a.splice(i+1,1);} } while(a.length<4) a.push(0); return a; }
    move(d){ let m=false;
      if(d===0){ for(let y=0;y<4;y++){ const n=this.slide(this.grid[y]); if(n.some((v,i)=>v!==this.grid[y][i])) m=true; this.grid[y]=n; } }
      if(d===1){ for(let y=0;y<4;y++){ let r=[...this.grid[y]].reverse(); r=this.slide(r).reverse(); if(r.some((v,i)=>v!==this.grid[y][i])) m=true; this.grid[y]=r; } }
      if(d===2){ for(let x=0;x<4;x++){ let c=[0,1,2,3].map(y=>this.grid[y][x]); c=this.slide(c); if(c.some((v,i)=>v!==this.grid[i][x])) m=true; for(let y=0;y<4;y++) this.grid[y][x]=c[y]; } }
      if(d===3){ for(let x=0;x<4;x++){ let c=[0,1,2,3].map(y=>this.grid[y][x]).reverse(); c=this.slide(c).reverse(); if(c.some((v,i)=>v!==this.grid[i][x])) m=true; for(let y=0;y<4;y++) this.grid[y][x]=c[y]; } }
      if(m) this.add(); if(this.over()) gameOver();
    }
    over(){ for(let y=0;y<4;y++) for(let x=0;x<4;x++){ if(!this.grid[y][x]) return false; if(x<3 && this.grid[y][x]===this.grid[y][x+1]) return false; if(y<3 && this.grid[y][x]===this.grid[y+1][x]) return false; } return true; }
    update(){} draw(){ ctx.fillStyle='#0e1631'; ctx.fillRect(0,0,canvas.width,canvas.height);
      const s=100, offX=(canvas.width-4*s)/2, offY=(canvas.height-4*s)/2;
      for(let y=0;y<4;y++) for(let x=0;x<4;x++){ const v=this.grid[y][x];
        ctx.fillStyle='rgba(255,255,255,.08)'; ctx.fillRect(offX+x*s+6,offY+y*s+6,s-12,s-12);
        if(v){ ctx.fillStyle= v<8? '#57ffd3' : v<32? '#ff57de' : v<128? '#ffd45a' : '#f7fbff';
          ctx.fillRect(offX+x*s+6,offY+y*s+6,s-12,s-12);
          ctx.fillStyle='#061018'; ctx.font='24px ui-monospace, Menlo, monospace'; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(String(v), offX+x*s+s/2, offY+y*s+s/2);
        }
      }
      drawHUD(this.score);
    }
    key(k,d){ if(!d) return; if(k==='ArrowLeft') this.move(0); if(k==='ArrowRight') this.move(1); if(k==='ArrowUp') this.move(2); if(k==='ArrowDown') this.move(3); }
  }

  function drawHUD(score){ ctx.font='20px ui-monospace, Menlo, monospace'; ctx.fillStyle='rgba(234,246,255,.85)'; ctx.fillText('Score: '+score, 16, 28); ctx.fillText('Best: '+best, 16, 52); }

  function gameOver(){
    running=false; stateEl.textContent='game over';
    if(game.score>best){ best=game.score; localStorage.setItem(BEST_KEY, best); $('#best').textContent=best; }
    saveLB();
    ctx.fillStyle='rgba(0,0,0,.55)'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='#eaf6ff'; ctx.font='28px ui-monospace, Menlo, monospace'; ctx.fillText('Game Over â€“ Press Play to restart', 220, canvas.height/2);
  }

  function startGame(){
    const type = $('#game').value;
    game = type==='snake'? new Snake() : type==='2048'? new G2048() : new Flappy();
    game.start(); running=true; paused=false; stateEl.textContent='playing'; $('#score').textContent='0';
    last=0; requestAnimationFrame(loop);
  }
  function loop(ts){ if(!running) return; if(!last) last=ts; const dt=ts-last; last=ts; frames++; if(frames%12===0){ fpsEl.textContent=Math.round(1000/dt); } if(!paused){ game.update(dt); game.draw(); $('#score').textContent=game.score; } requestAnimationFrame(loop); }

  window.addEventListener('keydown', e=>{ if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight','Space'].includes(e.code)) e.preventDefault(); if(e.code==='KeyP'){ paused=!paused; stateEl.textContent=paused?'paused':'playing'; return; } if(game) game.key(e.code,true); });
  window.addEventListener('keyup', e=>{ if(game) game.key(e.code,false); });
  $('#playBtn').onclick = startGame;

  /* ---------- Leaderboard (local) ---------- */
  function getLB(){ try { return JSON.parse(localStorage.getItem(LB_KEY)||'{}'); } catch { return {} } }
  function setLB(x){ localStorage.setItem(LB_KEY, JSON.stringify(x)); }
  function saveLB(){
    const g = $('#game').value, p=getProfile();
    const entry = { ts:Date.now(), nick:p.nickname||'guest', addr:p.payout||'â€”', score:game.score };
    const lb = getLB(); lb[g]=lb[g]||[]; lb[g].push(entry); lb[g].sort((a,b)=>b.score-a.score); lb[g]=lb[g].slice(0,20); setLB(lb);
    renderLB();
  }
  function renderLB(){
    const g = $('#lbGame').value, lb = getLB()[g]||[]; const box=$('#leaderList'); box.innerHTML='';
    lb.forEach((e,i)=>{ const d=document.createElement('div'); d.className='leader-item';
      d.innerHTML = `<span>#${i+1}</span><strong>${e.nick}</strong><span class="kbd">${e.addr && e.addr!=='â€”' ? e.addr.slice(0,4)+'â€¦'+e.addr.slice(-4) : 'â€”'}</span><strong>${e.score}</strong><span class="kbd">${new Date(e.ts).toLocaleString()}</span>`;
      box.appendChild(d);
    });
  }
  $('#lbGame').onchange = renderLB;
  $('#clearLB').onclick = ()=>{ const g=$('#lbGame').value, lb=getLB(); delete lb[g]; setLB(lb); renderLB(); };

  /* ---------- Stats on Cards ---------- */
  function statKey(g){ return 'plays_'+g }
  function incrementPlays(g){ const k=statKey(g); localStorage.setItem(k, Number(localStorage.getItem(k)||0)+1); refreshCardStats(); }
  function refreshCardStats(){
    const lb=getLB();
    const gameBest = g => (lb[g]?.[0]?.score ?? 'â€”');
    const plays = g => localStorage.getItem(statKey(g)) || 'â€”';
    $('#sflappy').textContent = gameBest('flappy');
    $('#ssnake').textContent  = gameBest('snake');
    $('#s2048').textContent   = gameBest('2048');
    $('#pflappy').textContent = plays('flappy');
    $('#psnake').textContent  = plays('snake');
    $('#p2048').textContent   = plays('2048');
  }
  refreshCardStats();

  // Splash canvas text
  (function(){ ctx.fillStyle='#071120'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.fillStyle='#eaf6ff'; ctx.font='28px ui-monospace,Menlo,monospace'; ctx.fillText('Choose a card to start playing', 260, canvas.height/2); })();
})();
</script>
</body>
</html>
